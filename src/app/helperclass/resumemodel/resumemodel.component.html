<ng-container *ngIf="isOpen">
  <!-- Backdrop -->
  <div class="fixed inset-0 bg-black/40 backdrop-blur-sm z-40"></div>

  <!-- Modal Container Centered -->
  <div class="fixed inset-0 flex items-center justify-center z-50 p-4 animate-fadeIn">

    <!-- MODAL ROOT (FIXED FOOTER, SCROLLABLE CONTENT) -->
    <div id="modal-container" class="bg-[#1E293B] w-full max-w-3xl rounded-2xl shadow-2xl 
             border border-[#334155] max-h-[85vh] flex flex-col text-white">

      <!-- ===========================
           SCROLLABLE CONTENT 
      ============================ -->
      <div class="flex-1 overflow-y-auto p-6">

        <!-- Header -->
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-xl font-semibold">Candidate Insights</h2>
          <button (click)="closeModel()" class="text-gray-300 hover:text-white">✕</button>
        </div>

        <!-- Section Card -->
        <div class="bg-[#0F172A] rounded-xl p-4 border border-[#334155] mb-5">

          <!-- Name -->
          <div class="mb-5">
            <div class="flex justify-between items-center">
              <label class="text-sm font-medium text-gray-400">Name</label>
              <button class="text-indigo-400 hover:text-indigo-300 text-sm" (click)="editProfile = !editProfile">
                ✏️ Edit
              </button>
            </div>

            <input *ngIf="editProfile" type="text" [(ngModel)]="resumeFilter.resume_id.name" class="w-full bg-[#1E293B] border border-[#475569] focus:border-indigo-400 
                     rounded-lg mt-2 px-3 py-2 text-sm outline-none" />

            <p *ngIf="!editProfile" class="text-sm mt-2">
              {{ resumeFilter.resume_id.name }}
            </p>
          </div>

          <!-- Experience -->
          <div class="mb-5">
            <p class="text-sm font-medium text-gray-400">Experience</p>

            <input *ngIf="editProfile" type="text" [(ngModel)]="resumeFilter.resume_id.yearsOfExperience" class="w-full bg-[#1E293B] border border-[#475569] 
                     focus:border-indigo-400 rounded-lg mt-2 px-3 py-2 text-sm" />

            <p *ngIf="!editProfile" class="text-sm mt-2">
              {{ resumeFilter.resume_id.yearsOfExperience }} years
            </p>
          </div>

          <!-- Location -->
          <div class="mb-5">
            <p class="text-sm font-medium text-gray-400">Location</p>

            <input *ngIf="editProfile" type="text" [(ngModel)]="resumeFilter.resume_id.address" class="w-full bg-[#1E293B] border border-[#475569] 
                     focus:border-indigo-400 rounded-lg mt-2 px-3 py-2 text-sm" />

            <p *ngIf="!editProfile" class="text-sm mt-2">
              {{ resumeFilter.resume_id.address }}
            </p>
          </div>

          <!-- Email -->
          <div class="mb-5">
            <p class="text-sm font-medium text-gray-400">Email</p>

            <input *ngIf="editProfile" type="text" [(ngModel)]="resumeFilter.resume_id.email" class="w-full bg-[#1E293B] border border-[#475569] 
                     focus:border-indigo-400 rounded-lg mt-2 px-3 py-2 text-sm" />

            <p *ngIf="!editProfile" class="text-sm mt-2">
              {{ resumeFilter.resume_id.email }}
            </p>
          </div>

        </div>

        <!-- Skills -->
        <div class="bg-[#0F172A] rounded-xl p-4 border border-[#334155] mb-5">
          <p class="text-sm font-medium text-gray-400 mb-2">Skills</p>
          <div class="flex flex-wrap gap-2">
            <span class="px-3 py-1 text-xs bg-indigo-600/20 text-indigo-300 rounded-md"
              *ngFor="let skill of resumeFilter.resume_id.skills">
              {{ skill.name }}
            </span>
          </div>
        </div>

        <!-- Suggestions -->
        <div class="bg-[#0F172A] rounded-xl p-4 border border-[#334155] mb-5">
          <p class="text-sm font-medium text-gray-400 mb-2">Suggestions</p>

          <div class="space-y-2">
            <div class="text-xs bg-yellow-600/20 text-yellow-300 px-3 py-2 rounded-md"
              *ngFor="let suggestion of resumeFilter.suggestions">
              {{ suggestion }}
            </div>
          </div>
        </div>

        <!-- Conclusion -->
        <div class="bg-[#0F172A] rounded-xl p-4 border border-[#334155] mb-6">
          <p class="text-sm font-medium text-gray-400 mb-2">Conclusion</p>
          <p class="text-xs text-red-300 bg-red-600/20 px-3 py-2 rounded-md">
            {{ resumeFilter.analysis }}
          </p>
        </div>

        <!-- Admin Controls -->
        <div class="border-t border-gray-700 pt-4 mb-6" *ngIf="loginService.getUserRoles().includes('ADMIN')">
          <!-- Dropdown -->
          <div class="mb-5 relative">
            <label class="text-sm font-medium text-gray-400 mb-1 block">Select Status</label>

            <button (click)="isDropdownOpen = !isDropdownOpen" class="w-full bg-[#1E293B] border border-[#475569] rounded-lg 
                     px-3 py-2.5 flex justify-between items-center text-sm">

              {{ resumeFilter.selectedStatus || 'Select status' }}

              <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
              </svg>
            </button>

            <div *ngIf="isDropdownOpen" class="absolute left-0 right-0 mt-2 bg-[#0F172A] border border-[#334155]
                     rounded-lg shadow-lg z-50 animate-fadeIn">

              <div *ngFor="let item of dropdownOptions" (click)="selectOption(item)"
                class="px-3 py-2 text-sm cursor-pointer hover:bg-[#1E293B] hover:text-indigo-300 text-gray-300">
                {{ item }}
              </div>

            </div>
          </div>
          <div class="mb-5">
            <label class="text-sm font-medium text-gray-400 mb-1 block">Interview Mode</label>

            <select [(ngModel)]="resumeFilter.interviewMode" class="w-full bg-[#1E293B] border border-[#475569] text-gray-200 
                     rounded-lg px-3 py-2.5 text-sm focus:border-indigo-400 focus:outline-none">

              <option value=" " disabled selected>Select mode</option>
              <option value="Online">Online</option>
              <option value="Offline">Offline</option>
            </select>
          </div>

          <!-- Date Picker -->
          <div class="mb-5">
            <label class="text-sm font-medium text-gray-400 mb-1 block">
              Select Interview Date
            </label>

            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" stroke-width="2"
                  viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4 10h16m-8-3V4M7 7V4m10 3V4M5 20h14a1 1 0 001-1V7a1 1 0 
            00-1-1H5a1 1 0 00-1 1v12a1 1 0 001 1z" />
                </svg>
              </div>

              <label for="interviewDate" class="block text-sm font-medium text-gray-300 mb-1">
                Interview Date
              </label>

              <div class="relative">
                <!-- Custom Calendar Icon -->
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 20 20"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M6 2v2m8-2v2M3 8h14M4 6h12a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V8a2 2 0 012-2z" />
                  </svg>
                </div>

                <input id="interviewDate" type="date" [(ngModel)]="resumeFilter.interviewDate" class="w-full pl-10 pr-3 py-2.5 rounded-lg border border-[#475569] 
           bg-[#1E293B] text-white placeholder-gray-400 shadow-sm
           focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" />
              </div>


            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-1">Interview Time</label>

            <div class="relative">
              <!-- Custom Clock Icon -->
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round"
                    d="M12 6v6l4 2m6-2a10 10 0 11-20 0 10 10 0 0120 0z" />
                </svg>
              </div>

              <select [(ngModel)]="resumeFilter.interviewTime" class="w-full pl-10 pr-3 py-2.5 rounded-lg border border-[#475569] bg-[#1E293B] text-white 
             shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500
             appearance-none">

                <option value="" disabled>Select time</option>
                <option *ngFor="let t of times12Hr" [value]="t">{{ t }}</option>

              </select>

              <!-- Dropdown Arrow -->
              <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3">
                <svg class="h-4 w-4 text-gray-400" fill="none" stroke="currentColor" stroke-width="2"
                  viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                </svg>
              </div>
            </div>
          </div>







        </div>

      </div> <!-- END SCROLLABLE CONTENT -->


      <!-- ===========================
           FIXED FOOTER
      ============================ -->
      <div class="border-t border-[#334155] px-6 py-4 bg-[#0F172A] 
                  flex justify-center items-center space-x-4 rounded-b-2xl">

        <!-- Save Candidate Details Button -->
        <button *ngIf="editProfile" class="px-5 py-2 bg-indigo-600 hover:bg-indigo-500 rounded-lg text-sm font-medium"
          (click)="saveCandidateDetails()">
          Save Candidate Details
        </button>

        <!-- Schedule Interview Button -->
        <button *ngIf="loginService.getUserRoles().includes('ADMIN')"
          class="px-5 py-2 bg-green-600 hover:bg-green-500 rounded-lg text-sm font-medium"
          (click)="sendInterviewEmail()">
          Send Interview Invite
        </button>

      </div>



    </div> <!-- END MODAL ROOT -->

  </div>
</ng-container>